(()=>{"use strict";var e={56:(e,n,t)=>{e.exports=function(e){var n=t.nc;n&&e.setAttribute("nonce",n)}},72:e=>{var n=[];function t(e){for(var t=-1,r=0;r<n.length;r++)if(n[r].identifier===e){t=r;break}return t}function r(e,r){for(var a={},i=[],s=0;s<e.length;s++){var d=e[s],c=r.base?d[0]+r.base:d[0],l=a[c]||0,p="".concat(c," ").concat(l);a[c]=l+1;var u=t(p),m={css:d[1],media:d[2],sourceMap:d[3],supports:d[4],layer:d[5]};if(-1!==u)n[u].references++,n[u].updater(m);else{var f=o(m,r);r.byIndex=s,n.splice(s,0,{identifier:p,updater:f,references:1})}i.push(p)}return i}function o(e,n){var t=n.domAPI(n);return t.update(e),function(n){if(n){if(n.css===e.css&&n.media===e.media&&n.sourceMap===e.sourceMap&&n.supports===e.supports&&n.layer===e.layer)return;t.update(e=n)}else t.remove()}}e.exports=function(e,o){var a=r(e=e||[],o=o||{});return function(e){e=e||[];for(var i=0;i<a.length;i++){var s=t(a[i]);n[s].references--}for(var d=r(e,o),c=0;c<a.length;c++){var l=t(a[c]);0===n[l].references&&(n[l].updater(),n.splice(l,1))}a=d}}},113:e=>{e.exports=function(e,n){if(n.styleSheet)n.styleSheet.cssText=e;else{for(;n.firstChild;)n.removeChild(n.firstChild);n.appendChild(document.createTextNode(e))}}},208:(e,n,t)=>{t.d(n,{A:()=>s});var r=t(601),o=t.n(r),a=t(314),i=t.n(a)()(o());i.push([e.id,'/* RESET */\n*,\n*::before,\n*::after {\n  box-sizing: border-box;\n  margin: 0;\n  padding: 0;\n}\n\nhtml {\n  font-size: 16px;\n}\n\nbody {\n  font-family: "Inter", sans-serif;\n  background-color: #f9fafb;\n  color: #1f2937;\n  line-height: 1.5;\n}\n\n/* LAYOUT */\n.app-container {\n  display: flex;\n  min-height: 100vh;\n  flex-direction: row;\n  overflow: hidden;\n}\n\n/* SIDEBAR */\n.sidebar {\n  background: linear-gradient(180deg, #6366f1, #4338ca);\n  color: #fff;\n  flex-shrink: 0;\n  width: 280px;\n  display: flex;\n  flex-direction: column;\n  justify-content: space-between;\n  transition: transform 0.3s ease;\n}\n\n.sidebar-header {\n  padding: 1.25rem;\n  font-size: 1.25rem;\n  font-weight: 600;\n  background: rgba(255, 255, 255, 0.1);\n}\n\n.sidebar-nav {\n  flex-grow: 1;\n  overflow-y: auto;\n  padding: 1.25rem;\n}\n\n/* .sidebar.open {\n  transform: translateX(0);\n} */\n\n.sidebar-toggle {\n  display: none;\n}\n\n.nav-section {\n  margin-bottom: 2rem;\n}\n\n.section-header {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  margin-bottom: 0.625rem;\n  color: #dbeafe;\n}\n\n.section-header h2 {\n  font-size: 1rem;\n  font-weight: 600;\n}\n\n.btn-icon {\n  background: none;\n  border: none;\n  color: #c7d2fe;\n  cursor: pointer;\n  font-size: 1rem;\n  transition: transform 0.2s ease;\n}\n\n.btn-icon:hover {\n  transform: scale(1.2);\n  color: #fff;\n}\n\n.filters {\n  display: flex;\n  flex-wrap: wrap;\n  gap: 0.625rem;\n}\n\n.filter-btn {\n  background: rgba(255, 255, 255, 0.2);\n  color: #4338ca;\n  border: none;\n  padding: 0.5rem 0.75rem;\n  border-radius: 0.375rem;\n  cursor: pointer;\n  transition: background 0.3s ease;\n}\n\n.filter-btn:hover,\n.filter-btn.active {\n  background: rgba(0, 0, 0, 0.3);\n}\n\n.projects-list {\n  list-style: none;\n}\n\n.project-item {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 0.5rem;\n  border-radius: 0.375rem;\n  cursor: pointer;\n  color: #dbeafe;\n  transition: background 0.3s ease;\n}\n\n.project-item:hover,\n.project-item.active {\n  background: rgba(255, 255, 255, 0.3);\n}\n\n.project-item i {\n  margin-right: 0.625rem;\n}\n\n.sidebar-footer {\n  padding: 1rem 1.25rem;\n  background: rgba(255, 255, 255, 0.1);\n}\n\n.user-profile {\n  display: flex;\n  align-items: center;\n  gap: 0.625rem;\n}\n\n.avatar i {\n  font-size: 1.25rem;\n}\n\n/* MAIN CONTENT */\n.main-content {\n  flex-grow: 1;\n  padding: 2rem;\n  overflow-y: auto;\n}\n\n.content-header {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  margin-bottom: 2rem;\n  border-bottom: 3px solid #6366f1;\n  padding-bottom: 1rem;\n}\n\n.content-header h2 {\n  font-size: 1.5rem;\n  color: #4338ca;\n}\n\n.header-actions {\n  display: flex;\n  gap: 1rem;\n  flex-wrap: wrap;\n}\n\n.search-box {\n  position: relative;\n}\n\n.search-box input {\n  padding: 0.5rem 2.5rem 0.5rem 2.5rem;\n  border: 1px solid #d1d5db;\n  border-radius: 0.375rem;\n  outline: none;\n  transition: border-color 0.3s ease;\n}\n\n.search-box input:focus {\n  border-color: #6366f1;\n}\n\n.search-box i {\n  position: absolute;\n  top: 50%;\n  left: 0.75rem;\n  transform: translateY(-50%);\n  color: #9ca3af;\n}\n\n.sort-select {\n  padding: 0.5rem;\n  border-radius: 0.375rem;\n  border: 1px solid #d1d5db;\n  background: #ffffff;\n}\n\n/* TASKS GRID */\n.tasks-list {\n  display: grid;\n  grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));\n  gap: 1.25rem;\n}\n\n/* RESPONSIVE - Sidebar collapsible on small screens */\n@media (max-width: 768px) {\n  .sidebar {\n    position: fixed;\n    top: 0;\n    left: 0;\n    height: 100%;\n    transform: translateX(-100%);\n    width: 220px;\n    z-index: 999;\n  }\n  .sidebar-toggle {\n    display: inline-block;\n  }\n\n  .sidebar.open {\n    transform: translateX(0);\n  }\n\n  .sidebar-overlay {\n    position: fixed;\n    top: 0;\n    left: 0;\n    height: 100%;\n    width: 100%;\n    background: rgba(0, 0, 0, 0.5);\n    opacity: 0;\n    pointer-events: none;\n    transition: opacity 0.3s ease;\n    z-index: 998;\n  }\n\n  .sidebar-overlay.active {\n    opacity: 1;\n    pointer-events: all;\n  }\n\n  .main-content {\n    padding: 1rem;\n  }\n\n  .content-header {\n    flex-direction: column;\n    align-items: flex-start;\n    gap: 10px;\n    padding: 10px 15px;\n  }\n\n  .content-header h2 {\n    font-size: 18px;\n    margin-bottom: 5px;\n  }\n\n  .header-actions {\n    width: 100%;\n    flex-wrap: wrap;\n    gap: 8px;\n    justify-content: space-between;\n  }\n\n  .filters {\n    flex-wrap: wrap;\n    width: 100%;\n    gap: 8px;\n    justify-content: flex-start;\n  }\n\n  .search-box input {\n    width: 100%;\n    font-size: 14px;\n  }\n\n  .sort-select {\n    width: 100%;\n    font-size: 14px;\n  }\n\n  .filter-btn {\n    flex: 1 1 48%;\n    font-size: 14px;\n    padding: 6px 8px;\n  }\n}\n\n/* TASK CARDS */\n.task-card {\n  background: #ffffff;\n  border-radius: 0.5rem;\n  padding: 1.25rem;\n  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);\n  border-left: 4px solid #6366f1;\n  display: flex;\n  flex-direction: column;\n  transition: transform 0.2s ease, box-shadow 0.2s ease;\n}\n\n.task-card:hover {\n  transform: translateY(-5px);\n  box-shadow: 0 10px 24px rgba(0, 0, 0, 0.15);\n}\n\n.task-card.completed {\n  opacity: 0.5;\n  text-decoration: line-through;\n}\n\n.tasks-section {\n  border: 2px solid #6366f1;\n  padding: 1rem;\n  border-radius: 0.5rem;\n  margin-bottom: 1.25rem;\n}\n\n.task-header {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n}\n\n.task-title {\n  font-size: 1rem;\n  font-weight: 600;\n  color: #1f2937;\n}\n\n.task-actions {\n  display: flex;\n  gap: 0.5rem;\n}\n\n.task-actions .btn-icon {\n  color: #6366f1;\n  font-size: 1rem;\n  transition: transform 0.2s ease;\n}\n\n.task-actions .btn-icon:hover {\n  transform: scale(1.2);\n}\n\n.task-description {\n  margin: 0.625rem 0;\n  font-size: 0.875rem;\n  color: #6b7280;\n}\n\n.task-meta {\n  display: flex;\n  justify-content: space-between;\n  font-size: 0.8125rem;\n  color: #6b7280;\n  margin-top: auto;\n}\n\n.task-priority.low {\n  color: #10b981;\n}\n\n.task-priority.medium {\n  color: #f59e0b;\n}\n\n.task-priority.high {\n  color: #ef4444;\n}\n\n/* DROPDOWN */\n.dropdown {\n  position: relative;\n}\n\n.dropdown-content.show {\n  display: block;\n}\n\n.dropdown-content {\n  display: none;\n  position: absolute;\n  top: 2rem;\n  right: 0;\n  background: #ffffff;\n  border: 1px solid #d1d5db;\n  border-radius: 0.375rem;\n  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);\n  z-index: 10;\n  width: 200px;\n  padding: 0.625rem;\n}\n\n.dropdown-content a {\n  display: block;\n  color: #374151;\n  padding: 0.5rem 0.75rem;\n  text-decoration: none;\n  font-size: 0.875rem;\n  border-radius: 0.375rem;\n  transition: background 0.2s ease;\n}\n\n.dropdown-content a:hover {\n  background-color: #f3f4f6;\n}\n\n.dropdown-title {\n  font-weight: bold;\n  font-size: 0.8125rem;\n  margin-bottom: 0.375rem;\n  color: #4b5563;\n}\n\n/* BUTTONS */\n.btn {\n  padding: 0.5rem 1rem;\n  border-radius: 0.375rem;\n  border: none;\n  cursor: pointer;\n  font-weight: 600;\n  transition: background 0.3s ease;\n}\n\n.btn-primary {\n  background: #6366f1;\n  color: #ffffff;\n}\n\n.btn-primary:hover {\n  background: #4338ca;\n}\n\n.btn-secondary {\n  background: #9ca3af;\n  color: #ffffff;\n}\n\n.btn-secondary:hover {\n  background: #6b7280;\n}\n\n/* MODALS */\n.modal {\n  position: fixed;\n  inset: 0;\n  background: rgba(0, 0, 0, 0.5);\n  display: none;\n  justify-content: center;\n  align-items: center;\n  z-index: 100;\n}\n\n.modal-content {\n  background: #ffffff;\n  border-radius: 0.5rem;\n  padding: 2rem;\n  width: 100%;\n  max-width: 500px;\n  position: relative;\n  animation: fadeIn 0.3s ease forwards;\n}\n\n@keyframes fadeIn {\n  from {\n    opacity: 0;\n    transform: translateY(-20px);\n  }\n  to {\n    opacity: 1;\n    transform: translateY(0);\n  }\n}\n\n.close-modal {\n  position: absolute;\n  top: 1rem;\n  right: 1rem;\n  background: none;\n  border: none;\n  font-size: 1.125rem;\n  cursor: pointer;\n  color: #6b7280;\n}\n\n/* FORMS */\n.modal-form .form-group,\n.modal-form .form-row {\n  margin-bottom: 1rem;\n}\n\n.modal-form label {\n  display: block;\n  margin-bottom: 0.5rem;\n  font-weight: 500;\n}\n\n.modal-form input,\n.modal-form select,\n.modal-form textarea {\n  width: 100%;\n  padding: 0.625rem;\n  border-radius: 0.375rem;\n  border: 1px solid #d1d5db;\n}\n\n.modal-form textarea {\n  resize: vertical;\n}\n\n.modal-form .form-actions {\n  display: flex;\n  justify-content: flex-end;\n  gap: 0.625rem;\n}\n\n/* EMPTY STATE */\n.empty-state {\n  text-align: center;\n  color: #9ca3af;\n  padding: 2.5rem;\n}\n\n.empty-state i {\n  font-size: 3rem;\n  margin-bottom: 1rem;\n  color: #d1d5db;\n}\n',""]);const s=i},314:e=>{e.exports=function(e){var n=[];return n.toString=function(){return this.map(function(n){var t="",r=void 0!==n[5];return n[4]&&(t+="@supports (".concat(n[4],") {")),n[2]&&(t+="@media ".concat(n[2]," {")),r&&(t+="@layer".concat(n[5].length>0?" ".concat(n[5]):""," {")),t+=e(n),r&&(t+="}"),n[2]&&(t+="}"),n[4]&&(t+="}"),t}).join("")},n.i=function(e,t,r,o,a){"string"==typeof e&&(e=[[null,e,void 0]]);var i={};if(r)for(var s=0;s<this.length;s++){var d=this[s][0];null!=d&&(i[d]=!0)}for(var c=0;c<e.length;c++){var l=[].concat(e[c]);r&&i[l[0]]||(void 0!==a&&(void 0===l[5]||(l[1]="@layer".concat(l[5].length>0?" ".concat(l[5]):""," {").concat(l[1],"}")),l[5]=a),t&&(l[2]?(l[1]="@media ".concat(l[2]," {").concat(l[1],"}"),l[2]=t):l[2]=t),o&&(l[4]?(l[1]="@supports (".concat(l[4],") {").concat(l[1],"}"),l[4]=o):l[4]="".concat(o)),n.push(l))}},n}},540:e=>{e.exports=function(e){var n=document.createElement("style");return e.setAttributes(n,e.attributes),e.insert(n,e.options),n}},601:e=>{e.exports=function(e){return e[1]}},659:e=>{var n={};e.exports=function(e,t){var r=function(e){if(void 0===n[e]){var t=document.querySelector(e);if(window.HTMLIFrameElement&&t instanceof window.HTMLIFrameElement)try{t=t.contentDocument.head}catch(e){t=null}n[e]=t}return n[e]}(e);if(!r)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");r.appendChild(t)}},825:e=>{e.exports=function(e){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var n=e.insertStyleElement(e);return{update:function(t){!function(e,n,t){var r="";t.supports&&(r+="@supports (".concat(t.supports,") {")),t.media&&(r+="@media ".concat(t.media," {"));var o=void 0!==t.layer;o&&(r+="@layer".concat(t.layer.length>0?" ".concat(t.layer):""," {")),r+=t.css,o&&(r+="}"),t.media&&(r+="}"),t.supports&&(r+="}");var a=t.sourceMap;a&&"undefined"!=typeof btoa&&(r+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(a))))," */")),n.styleTagTransform(r,e,n.options)}(n,e,t)},remove:function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(n)}}}}},n={};function t(r){var o=n[r];if(void 0!==o)return o.exports;var a=n[r]={id:r,exports:{}};return e[r](a,a.exports,t),a.exports}t.n=e=>{var n=e&&e.__esModule?()=>e.default:()=>e;return t.d(n,{a:n}),n},t.d=(e,n)=>{for(var r in n)t.o(n,r)&&!t.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:n[r]})},t.o=(e,n)=>Object.prototype.hasOwnProperty.call(e,n),t.nc=void 0;const r=e=>{if(!e||"string"!=typeof e||!e.trim())throw new Error("Le nom du projet est obligatoire.");let n=[];return{id:crypto.randomUUID(),name:e.trim(),addTask(e){if(!e?.id)throw new Error("La tâche est invalide : ID manquant.");if(n.some(n=>n.id===e.id))throw new Error("Cette tâche existe déjà dans le projet.");n.push(e)},removeTask(e){const t=n.length;return n=n.filter(n=>n.id!==e),t!==n.length},getTasks:()=>[...n],getTaskById:e=>n.find(n=>n.id===e),getFilteredTasks(e){const t=new Date;t.setHours(0,0,0,0);const r=new Date(t);return r.setDate(t.getDate()+7),n.filter(n=>{const o=n.dueDate?new Date(n.dueDate):null;switch(e){case"today":return o?.toDateString()===t.toDateString();case"week":return o&&o>=t&&o<=r;case"upcoming":return o&&o>t;case"completed":return n.completed;case"high-priority":return"high"===n.priority;default:return!0}})},updateName(e){if(!e?.trim())throw new Error("Le nom du projet est obligatoire.");this.name=e.trim()}}},o=(e=[])=>{const n=e.length>0?e.map(e=>{const n=r(e.name);return e.tasks.forEach(e=>n.addTask(e)),n}):[];let t=[];return{addProject(e){if(!e?.id)throw new Error("Projet invalide");n.push(e)},removeProject(e){const r=n.findIndex(n=>n.id===e);if(-1!==r){const e=n[r].getTasks();t.push(...e.map(e=>({...e,projectId:null}))),n.splice(r,1)}},getProjects:()=>[...n],getProjectById:e=>n.find(n=>n.id===e),addOrphanTask(e){if(e.projectId)throw new Error("La tâche appartient déjà à un projet");t.push(e)},getOrphanTasks:()=>[...t],removeOrphanTask(e){const n=t.findIndex(n=>n.id===e);1!==n&&t.splice(n,1)},getAllTasks(){return[...this.getOrphanTasks(),...n.flatMap(e=>e.getTasks())]},moveTaskToProject(e,r=null){let o;const a=t.findIndex(n=>n.id===e);if(-1!==a)o=t[a],t.splice(a,1);else for(const t of n)if(o=t.getTaskById(e),o){t.removeTask(e);break}if(!o)throw new Error("Tâche introuvable");if(!r)return o.projectId=null,void this.addOrphanTask(o);const i=n.find(e=>e.id===r);if(!i)throw new Error("Projet cible introuvable");o.projectId=r,i.addTask(o)},ensureDefaultProjectExists(){n.some(e=>"Inbox"===e.name)||this.addProject(r("Inbox"))}}},a=(e,n="",t=null,r="medium",o=null)=>{if("string"!=typeof e||!e.trim())throw new Error("Le titre est obligatoire.");if(t&&!(e=>{if(!e)return!1;const n=new Date(e);return!isNaN(n.getTime())})(t))throw new Error("Format de date invalide.");return["low","medium","high"].includes(r)||(r="medium"),{id:crypto.randomUUID(),title:e.trim(),description:n.trim(),dueDate:t?new Date(t).toISOString():null,priority:r,completed:!1,createdAt:(new Date).toISOString(),projectId:o,toggleCompleted(){this.completed=!this.completed},updateDetails(e){const{id:n,createdAt:t,...r}=e;Object.assign(this,r)}}},i="todoListData",s=e=>{const n={projects:e.getProjects().map(e=>({id:e.id,name:e.name,tasks:e.getTasks().map(e=>({id:e.id,title:e.title,description:e.description,dueDate:e.dueDate,priority:e.priority,completed:e.completed,createdAt:e.createdAt,projectId:e.projectId}))})),orphanTasks:e.getOrphanTasks().map(e=>({...e,projectId:null}))};localStorage.setItem(i,JSON.stringify(n))};var d=t(72),c=t.n(d),l=t(825),p=t.n(l),u=t(659),m=t.n(u),f=t(56),g=t.n(f),h=t(540),b=t.n(h),k=t(113),y=t.n(k),v=t(208),j={};j.styleTagTransform=y(),j.setAttributes=g(),j.insert=m().bind(null,"head"),j.domAPI=p(),j.insertStyleElement=b(),c()(v.A,j),v.A&&v.A.locals&&v.A.locals;document.addEventListener("DOMContentLoaded",()=>{let e=(()=>{const e=localStorage.getItem(i);if(!e)return null;try{const n=JSON.parse(e),t=o();return n.projects&&n.projects.forEach(e=>{const n=r(e.name);n.id=e.id,e.tasks.forEach(e=>{const t=a(e.title,e.description,e.dueDate,e.priority,n.id);t.completed=e.completed,t.createdAt=e.createdAt,t.id=e.id,n.addTask(t)}),t.addProject(n)}),n.orphanTasks&&n.orphanTasks.forEach(e=>{const n=a(e.title,e.description,e.dueDate,e.priority,null);n.completed=e.completed,n.createdAt=e.createdAt,n.id=e.id,t.addOrphanTask(n)}),t}catch(e){return console.error("Erreur lors du chargement des données:",e),null}})();if(!e){e=o();const n=r("Projet par defaut");e.addProject(n),s(e)}(e=>{const n={projectsList:document.getElementById("projects-list"),tasksList:document.getElementById("tasks-list"),currentProjectName:document.getElementById("current-project-name"),addProjectBtn:document.getElementById("add-project-btn"),addTaskBtn:document.getElementById("add-task-btn"),taskModal:document.getElementById("task-modal"),projectModal:document.getElementById("project-modal"),taskForm:document.getElementById("task-form"),projectForm:document.getElementById("project-form"),filterControls:document.querySelector(".filters"),taskProjectSelect:document.getElementById("task-project"),taskSearch:document.getElementById("task-search"),sortTasks:document.getElementById("sort-tasks"),taskNavItem:document.getElementById("task-nav-item")},t={currentProjectId:"all",currentFilter:"all",editTaskId:null,searchQuery:"",sortOption:"dueDate-asc"},o=()=>{n.taskNavItem.innerHTML="",n.projectsList.innerHTML="";const r=i({id:"all",name:"Toutes les tâches",active:"all"===t.currentProjectId});n.taskNavItem.appendChild(r);const o=i({id:"orphan",name:"Tâches non-spècifiques",active:"orphan"===t.currentProjectId});n.taskNavItem.appendChild(o),e.getProjects().forEach(e=>{const r=i({id:e.id,name:e.name,taskCount:e.getTasks().length,active:t.currentProjectId===e.id});n.projectsList.appendChild(r)})},i=({id:e,name:n,taskCount:t,active:r})=>{const o=document.createElement("li");return o.className="project-item "+(r?"active":""),o.dataset.projectId=e,o.innerHTML=`\n      <i class="fas ${"all"===e?"fa-inbox":"orphan"===e?"fa-layer-group":"fa-folder"}"></i>\n      <span class="project-name">${n}</span>\n      ${void 0!==t?`<span class="task-count">${t}</span>`:""}\n      ${"all"!==e&&"orphan"!==e?'<button class="delete-project-btn"><i class="fas fa-trash"></i></button>':""}\n    `,o.addEventListener("click",()=>d(e)),"all"!==e&&"orphan"!==e&&o.querySelector(".delete-project-btn").addEventListener("click",n=>{n.stopPropagation(),L(e)}),o},d=n=>{if(t.currentProjectId=n,"all"===n)l("Toutes les tâches");else if("orphan"===n)l("Tâches non-spècifiques");else{const t=e.getProjectById(n);l(t?.name||"Projet inconnu")}c(n),p()},c=e=>{document.querySelectorAll(".project-item").forEach(n=>{n.classList.toggle("active",n.dataset.projectId===e)})},l=e=>{n.currentProjectName.textContent=e},p=()=>{n.tasksList.innerHTML="";let r=[];if("all"===t.currentProjectId)r=[...e.getOrphanTasks(),...e.getProjects().flatMap(e=>e.getTasks())];else if("orphan"===t.currentProjectId)r=e.getOrphanTasks();else{const n=e.getProjectById(t.currentProjectId);r=n?n.getTasks():[]}let o=((e,n)=>{const t=new Date;t.setHours(0,0,0,0);const r=new Date(t);return r.setDate(t.getDate()+7),e.filter(e=>{if(!e.dueDate)return"completed"===n?e.completed:"high-priority"===n&&"high"===e.priority;const o=new Date(e.dueDate);switch(o.setHours(0,0,0,0),n){case"today":return o.getTime()===t.getTime();case"week":return o>=t&&o<=r;case"upcoming":return o>t;case"completed":return e.completed;case"high-priority":return"high"===e.priority;case"no-date":return!e.dueDate;default:return!0}})})(r,t.currentFilter);t.searchQuery&&(o=o.filter(e=>e.title.toLowerCase().includes(t.searchQuery.toLowerCase())||e.description&&e.description.toLowerCase().includes(t.searchQuery.toLowerCase()))),o=b(o,t.sortOption),0!==o.length?"all"===t.currentProjectId?u(o):o.forEach(e=>{n.tasksList.appendChild(h(e))}):g()},u=t=>{n.tasksList.innerHTML="";const r=t.filter(e=>!e.projectId);r.length>0&&n.tasksList.appendChild(m("Tâches non-spècifiques",r)),e.getProjects().forEach(e=>{const r=t.filter(n=>n.projectId===e.id);r.length>0&&n.tasksList.appendChild(m(e.name,r))})},m=(e,n)=>{const t=document.createElement("div");t.className="tasks-section";const r=f(e,n.length),o=document.createElement("div");return o.className="tasks-group",n.forEach(e=>{o.appendChild(h(e))}),t.appendChild(r),t.appendChild(o),t},f=(e,n)=>{const t=document.createElement("div");return t.className="tasks-section-header",t.innerHTML=`\n      <h3>${e}</h3>\n      <span class="task-count">${n}</span>\n    `,t},g=()=>{n.tasksList.innerHTML=`\n      <div class="empty-state">\n        <i class="fas fa-clipboard-list"></i>\n        <h3>Aucune tâche à afficher</h3>\n        <p>${t.searchQuery?"Aucun résultat pour votre recherche.":"Commencez par ajouter une nouvelle tâche."}</p>\n      </div>\n    `},h=n=>{const t=document.createElement("div");t.className=`task-card ${n.priority}-priority ${n.completed?"completed":""}`,t.dataset.taskId=n.id;const r=n.dueDate?new Date(n.dueDate):null,o=r?r.toLocaleDateString("fr-FR"):"Non définie";return t.innerHTML=`\n      <div class="task-header">\n        <input type="checkbox" ${n.completed?"checked":""} class="task-checkbox">\n        <div class="task-title">${n.title}</div>\n        <div class="task-actions">\n          <button class="btn-icon edit-btn"><i class="fas fa-edit"></i></button>\n          <button class="btn-icon delete-btn"><i class="fas fa-trash"></i></button>\n          <div class="dropdown">\n            <button class="btn-icon move-btn"><i class="fas fa-folder"></i></button>\n            <div class="dropdown-content">\n              <span class="dropdown-title">Déplacer vers :</span>\n              ${e.getProjects().map(e=>`<a href="#" data-project-id="${e.id}">${e.name}</a>`).join("")}\n              ${n.projectId?'<a href="#" data-project-id="orphan">Tâches non-spécifiques</a>':""}\n            </div>\n          </div>\n        </div>\n      </div>\n      ${n.description?`<p class="task-description">${n.description}</p>`:""}\n      <div class="task-meta">\n        <span class="task-due-date">\n          <i class="far fa-calendar-alt"></i>\n          ${o}\n        </span>\n        <span class="task-priority ${n.priority}">\n          <i class="fas fa-exclamation-circle"></i>\n          ${k(n.priority)}\n        </span>\n      </div>\n    `,t.querySelector(".task-checkbox").addEventListener("change",()=>{n.toggleCompleted(),y()}),t.querySelector(".edit-btn").addEventListener("click",e=>{e.stopPropagation(),j(n)}),t.querySelector(".delete-btn").addEventListener("click",t=>{if(t.stopPropagation(),confirm("Supprimer cette tâche ?")){if(n.projectId){const t=e.getProjectById(n.projectId);t?.removeTask(n.id)}else e.removeOrphanTask(n.id);y()}}),t.querySelector(".move-btn").addEventListener("click",e=>{e.stopPropagation(),t.querySelector(".dropdown-content").classList.toggle("show")}),t.querySelectorAll(".dropdown-content a").forEach(t=>{t.addEventListener("click",r=>{r.preventDefault();const o=t.dataset.projectId;e.moveTaskToProject(n.id,"orphan"===o?null:o),y()})}),t},b=(e,n)=>{const[t,r]=n.split("-");return[...e].sort((e,n)=>{if(!e.dueDate&&n.dueDate)return 1;if(e.dueDate&&!n.dueDate)return-1;let o=0;switch(t){case"dueDate":o=new Date(e.dueDate)-new Date(n.dueDate);break;case"priority":const t={high:3,medium:2,low:1};o=t[n.priority]-t[e.priority];break;case"createdAt":o=new Date(e.createdAt)-new Date(n.createdAt);break;default:o=e.title.localeCompare(n.title)}return"desc"===r?-o:o})},k=e=>({low:"Faible",medium:"Moyenne",high:"Haute"}[e]||e),y=()=>{s(e),o(),p()},v=()=>{n.taskModal.style.display="none",n.projectModal.style.display="none",t.editTaskId=null},j=(e=null)=>{n.taskModal.style.display="flex",n.taskForm.reset(),t.editTaskId=e?.id||null,e&&(document.getElementById("task-title").value=e.title,document.getElementById("task-description").value=e.description||"",document.getElementById("task-due-date").value=e.dueDate||"",document.getElementById("task-priority").value=e.priority),x(e?.projectId||t.currentProjectId)},x=(t=null)=>{n.taskProjectSelect.innerHTML='<option value="">Tâches non-spècifiques</option>',e.getProjects().forEach(e=>{const r=document.createElement("option");r.value=e.id,r.textContent=e.name,e.id===t&&(r.selected=!0),n.taskProjectSelect.appendChild(r)})},w=e=>{e.preventDefault();const r={title:document.getElementById("task-title").value.trim(),description:document.getElementById("task-description").value.trim(),dueDate:document.getElementById("task-due-date").value,priority:document.getElementById("task-priority").value,projectId:n.taskProjectSelect.value||null};r.title?(t.editTaskId?T(r):I(r),v()):alert("Le titre est obligatoire.")},I=n=>{const t=a(n.title,n.description,n.dueDate,n.priority,n.projectId);if(n.projectId){const r=e.getProjectById(n.projectId);r?.addTask(t)}else e.addOrphanTask(t);y()},T=n=>{let r=null,o=null;for(const n of e.getProjects()){const e=n.getTaskById(t.editTaskId);if(e){r=e,o=n;break}}if(r||(r=e.getOrphanTasks().find(e=>e.id===t.editTaskId)),r){if(n.projectId!==r.projectId){const t=n.projectId||null;if(r.projectId){const n=e.getProjectById(r.projectId);n?.removeTask(r.id)}else e.removeOrphanTask(r.id);if(t){const n=e.getProjectById(t);n?.addTask(r)}else e.addOrphanTask(r);r.projectId=t}r.updateDetails({title:n.title,description:n.description,dueDate:n.dueDate,priority:n.priority}),y()}else alert("Tâche introuvable.")},E=n=>{n.preventDefault();const t=document.getElementById("project-name").value.trim();if(!t)return void alert("Le nom du projet est obligatoire.");const o=r(t);e.addProject(o),v(),y()},L=n=>{confirm("Supprimer ce projet et toutes ses tâches ?")&&(e.removeProject(n),t.currentProjectId===n?d("all"):y())};n.filterControls.addEventListener("click",e=>{const n=e.target.closest(".filter-btn");n&&(document.querySelectorAll(".filter-btn").forEach(e=>e.classList.remove("active")),n.classList.add("active"),t.currentFilter=n.dataset.filter,p())}),n.taskSearch.addEventListener("input",e=>{t.searchQuery=e.target.value.trim(),p()}),n.sortTasks.addEventListener("change",e=>{t.sortOption=e.target.value,p()}),n.addProjectBtn.addEventListener("click",()=>{n.projectModal.style.display="flex",n.projectForm.reset()}),n.addTaskBtn.addEventListener("click",()=>{j()}),document.querySelectorAll(".close-modal").forEach(e=>{e.addEventListener("click",v)}),window.addEventListener("click",e=>{e.target!==n.taskModal&&e.target!==n.projectModal||v(),document.querySelectorAll(".dropdown-content.show").forEach(n=>{n.contains(e.target)||e.target.closest(".move-btn")||n.classList.remove("show")})}),n.taskForm.addEventListener("submit",w),n.projectForm.addEventListener("submit",E),o(),d("all")})(e)}),document.addEventListener("DOMContentLoaded",()=>{const e=document.querySelector(".sidebar"),n=document.querySelector(".sidebar-toggle"),t=document.querySelector(".sidebar-overlay");n&&e&&t&&(n.addEventListener("click",()=>{e.classList.toggle("open"),t.classList.toggle("active")}),t.addEventListener("click",()=>{e.classList.remove("open"),t.classList.remove("active")}))})})();